<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <head>
      <meta name="viewport" content="width=device-width,initial-scale=1.0">
    </head>
    <meta charset="UTF-8" />
    <script src="jsPsych-6.3.1/jspsych.js"></script>
    <script src="jsPsych-6.3.1/plugins/jspsych-instructions.js"></script>
    <script src="jsPsych-6.3.1/plugins/jspsych-survey-multi-choice.js"></script>
    <script src="jsPsych-6.3.1/plugins/jspsych-survey-html-form.js"></script>    
    <script src="jsPsych-6.3.1/plugins/jspsych-survey-text.js"></script>
    <script src="jsPsych-6.3.1/plugins/jspsych-survey-likert.js"></script>

    <script src="affectGrid.js"></script>

    <link href="jsPsych-6.3.1/css/jspsych.css" rel="stylesheet" type="text/css" />
    <link href="style.css" rel="stylesheet" type="text/css" />

  </head>
  <body></body>
  <script>

  var par_info = {
    parID: jsPsych.randomization.randomID(12),
  }

  var timeline = [];    
  var scale = ["0<br/>まったく感じない","1","2","3","4<br/>強く感じる"];
  var sad_01 = [
    {message: 'sad_01++'},
    {message: 'sad_02+-'},
    {message: 'sad_03-+'},
    {message: 'sad_04--'},
  ];
  var sad_02 = [
    {message: 'sad_02++'},
    {message: 'sad_03+-'},
    {message: 'sad_04-+'},
    {message: 'sad_01--'},
  ];
  var sad_03 = [
    {message: 'sad_03++'},
    {message: 'sad_04+-'},
    {message: 'sad_01-+'},
    {message: 'sad_02--'},
  ];
  var sad_04 = [
    {message: 'sad_04++'},
    {message: 'sad_01+-'},
    {message: 'sad_02-+'},
    {message: 'sad_03--'},
  ];
  var sad_emoji = [sad_01, sad_02, sad_03, sad_04];

  var anger_01 = [
    {message: 'anger_01++'},
    {message: 'anger_02+-'},
    {message: 'anger_03-+'},
    {message: 'anger_04--'},
  ];
  var anger_02 = [
    {message: 'anger_02++'},
    {message: 'anger_03+-'},
    {message: 'anger_04-+'},
    {message: 'anger_01--'},
  ];
  var anger_03 = [
    {message: 'anger_03++'},
    {message: 'anger_04+-'},
    {message: 'anger_01-+'},
    {message: 'anger_02--'},
  ];
  var anger_04 = [
    {message: 'anger_04++'},
    {message: 'anger_01+-'},
    {message: 'anger_02-+'},
    {message: 'anger_03--'},
  ];

  var anger_emoji = [anger_01, anger_02, anger_03, anger_04];

  var joy_01 = [
    {message: 'joy_01++'},
    {message: 'joy_02+-'},
    {message: 'joy_03-+'},
    {message: 'joy_04--'},
  ];
  var joy_02 = [
    {message: 'joy_02++'},
    {message: 'joy_03+-'},
    {message: 'joy_04-+'},
    {message: 'joy_01--'},
  ];
  var joy_03 = [
    {message: 'joy_03++'},
    {message: 'joy_04+-'},
    {message: 'joy_01-+'},
    {message: 'joy_02--'},
  ];
  var joy_04 = [
    {message: 'joy_04++'},
    {message: 'joy_01+-'},
    {message: 'joy_02-+'},
    {message: 'joy_03--'},
  ];

  var joy_emoji = [joy_01, joy_02, joy_03, joy_04];


  var nenrei = {
    type: 'survey-html-form',
    preamble: '<div class="inst_text"><span>あなたの年齢をお答えください。</span></div>',
    html: '<input type="number" required>',
    button_label:'次へ',
  };

  var seibetsu = {
    type: 'survey-multi-choice',
    questions: [
      {
        prompt: '<div class="inst_text"><span>あなたの性別をお答えください。</span></div>',
        name: 'FriendCloseness',
        options:['男','女','その他','答えたくない'],
        required: true
      }
    ],
    button_label:'次へ',
  };

  var hajimeni = {
    type: 'instructions',
    pages: [
      `<div class="inst_text"><span>この調査は〜（ここに調査趣旨の説明）。</span></div>`,
    ],
    allow_backward: false,
    button_label_next:'次へ',
    show_clickable_nav: true,
  };

  
  var shitashisa = {
    type: 'survey-multi-choice',
    questions: [
      {
        prompt: '<div class="inst_text"><span>普段，メッセージ（LINEなど）でよくやり取りする相手を一人，思い浮かべてください。<br /><br />その相手とあなたはどの程度親しいですか？</span></div>',
        name: 'FriendCloseness',
        options:['とても親しい','少し親しい','どちらともいえない','あまり親しくない','まったく親しくない'],
        required: true
      }
    ],
    button_label:'次へ',
  };

  var emoji1 = {
    type: 'survey-multi-choice',
    questions: [
      {
        prompt: '<div class="inst_text"><span>その<font color="blue"><b>相手</b></font>は，あなたとの普段のやりとりでどの程度「絵文字」や「顔文字」を使用しますか？</span></div>',
        name: 'EmojiAite',
        options:['いつも使う', 'よく使う','ときどき使う','まれに使う','まったく使わない'],
        required: true
      }
    ],
    button_label:'次へ',
  };

  var emoji2 = {
    type: 'survey-multi-choice',
    questions: [
      {
        prompt: '<div class="inst_text"><span>では，<font color="red"><b>あなた自身</b></font>は，その相手とのやりとりで普段どの程度「絵文字」や「顔文字」を使用しますか？</span></div>',
        name: 'EmojiJibun',
        options:['いつも使う', 'よく使う','ときどき使う','まれに使う','まったく使わない'],
        required: true
      }
    ],
    button_label:'次へ',
  };

  var AGsetsumei = {
    type: 'instructions',
    pages: [
      `<div class="inst_text"><span>これから〜（ここにアフェクト・グリッドの説明）。</span></div>`,
    ],
    allow_backward: false,
    button_label_next:'次へ',
    show_clickable_nav: true,
  };

  var KadaiSetsumei = {
    type: 'instructions',
    pages: [
      `<div class="inst_text"><span>これからさまざまな状況でやりとりされるメッセージについての評価を〜それぞれの場面であなたが普段よくやり取りする相手からメッセージが送られてきた場面を〜（課題の説明）。</span></div>`,
    ],
    allow_backward: false,
    button_label_next:'次へ',
    show_clickable_nav: true,
  };


// main
var Counter=0;

var sad_hyoka = {
  timeline: [
    {
      type: 'survey-html-form',
      preamble: function(){
        var html = `<div class="inst_text"><span><b>場面${Math.floor(Counter/3)+1}</b><br/><br/>〜として，次のメッセージが送られてきた場面を想定してください。<br /><br />このとき，<font color="red"><b>あなた</b></font>が感じると考えられる感情の位置を，アフェクト・グリッド上で示してください。</span></div><br/><div>'<img src="imgs/${jsPsych.timelineVariable('message')}.png" class = "emoji_stim"></div><br/>`;
        return html;
      },
      html: affect_grid1,
      data: {imgID: jsPsych.timelineVariable('message')},
    },
    {
      type: 'survey-likert',
      preamble: function(){
        var html = `<div class="inst_text"><span>（場面${Math.floor(Counter/3)+1}の続き）<br/>このメッセージに対し，<font color="red"><b>あなた</b></font>は次のそれぞれの感情をどの程度感じると思いますか。「0：まったく感じない」から「4：強く感じる」までの数字のうち，もっとも近いものを1つずつ選んでください。</span></div><br/><div>'<img src="imgs/${jsPsych.timelineVariable('message')}.png" class = "emoji_stim"></div><br/>`;
        return html;
      },
      questions: [
        { prompt: "満足な", labels: scale, required: true},
        { prompt: "悲しい", labels: scale, required: true},
        { prompt: "腹が立つ", labels: scale, required: true},
        { prompt: "嬉しい", labels: scale, required: true},
        { prompt: "気分が良い", labels: scale, required: true},
        { prompt: "不快な", labels: scale, required: true},
      ],
      data: {imgID: jsPsych.timelineVariable('message')},
    },
    {
      type: 'survey-likert',
      preamble: function(){
        var html = `<div class="inst_text"><span>（場面${Math.floor(Counter/3)+1}の続き）<br/>このメッセージの<font color="blue"><b>送り主</b></font>は，次のそれぞれの感情をどの程度感じていると思いますか。「0：まったく感じない」から「4：強く感じる」までの数字のうち，もっとも近いものを1つずつ選んでください。</span></div><br/><div>'<img src="imgs/${jsPsych.timelineVariable('message')}.png" class = "emoji_stim"></div><br/>`;
        return html;
      },
      questions: [
        { prompt: "満足な", labels: scale, required: true},
        { prompt: "悲しい", labels: scale, required: true},
        { prompt: "腹が立つ", labels: scale, required: true},
        { prompt: "嬉しい", labels: scale, required: true},
        { prompt: "気分が良い", labels: scale, required: true},
        { prompt: "不快な", labels: scale, required: true},
      ],
      data: {imgID: jsPsych.timelineVariable('message')},
    },
  ],
  button_label: '次へ',
  timeline_variables: jsPsych.randomization.sampleWithReplacement(sad_emoji, 1)[0],
  randomize_order: true,
  on_finish: function () { 
    Counter += 1 ;
  },
}

var anger_hyoka = {
  timeline: [
    {
      type: 'survey-html-form',
      preamble: function(){
        var html = `<div class="inst_text"><span><b>場面${Math.floor(Counter/3)+1}</b><br/><br/>〜として，次のメッセージが送られてきた場面を想定してください。<br /><br />このとき，<font color="red"><b>あなた</b></font>が感じると考えられる感情の位置を，アフェクト・グリッド上で示してください。</span></div><br/><div>'<img src="imgs/${jsPsych.timelineVariable('message')}.png" class = "emoji_stim"></div><br/>`;
        return html;
      },
      html: affect_grid1,
      data: {imgID: jsPsych.timelineVariable('message')},
    },
    {
      type: 'survey-likert',
      preamble: function(){
        var html = `<div class="inst_text"><span>（場面${Math.floor(Counter/3)+1}の続き）<br/>このメッセージに対し，<font color="red"><b>あなた</b></font>は次のそれぞれの感情をどの程度感じると思いますか。「0：まったく感じない」から「4：強く感じる」までの数字のうち，もっとも近いものを1つずつ選んでください。</span></div><br/><div>'<img src="imgs/${jsPsych.timelineVariable('message')}.png" class = "emoji_stim"></div><br/>`;
        return html;
      },
      questions: [
        { prompt: "満足な", labels: scale, required: true},
        { prompt: "悲しい", labels: scale, required: true},
        { prompt: "腹が立つ", labels: scale, required: true},
        { prompt: "嬉しい", labels: scale, required: true},
        { prompt: "気分が良い", labels: scale, required: true},
        { prompt: "不快な", labels: scale, required: true},
      ],
      data: {imgID: jsPsych.timelineVariable('message')},
    },
    {
      type: 'survey-likert',
      preamble: function(){
        var html = `<div class="inst_text"><span>（場面${Math.floor(Counter/3)+1}の続き）<br/>このメッセージの<font color="blue"><b>送り主</b></font>は，次のそれぞれの感情をどの程度感じていると思いますか。「0：まったく感じない」から「4：強く感じる」までの数字のうち，もっとも近いものを1つずつ選んでください。</span></div><br/><div>'<img src="imgs/${jsPsych.timelineVariable('message')}.png" class = "emoji_stim"></div><br/>`;
        return html;
      },
      questions: [
        { prompt: "満足な", labels: scale, required: true},
        { prompt: "悲しい", labels: scale, required: true},
        { prompt: "腹が立つ", labels: scale, required: true},
        { prompt: "嬉しい", labels: scale, required: true},
        { prompt: "気分が良い", labels: scale, required: true},
        { prompt: "不快な", labels: scale, required: true},
      ],
      data: {imgID: jsPsych.timelineVariable('message')},
    },
  ],
  button_label: '次へ',
  timeline_variables: jsPsych.randomization.sampleWithReplacement(anger_emoji, 1)[0],
  randomize_order: true,
  on_finish: function () { 
    Counter += 1 ;
  },
}

var joy_hyoka = {
  timeline: [
    {
      type: 'survey-html-form',
      preamble: function(){
        var html = `<div class="inst_text"><span><b>場面${Math.floor(Counter/3)+1}</b><br/><br/>〜として，次のメッセージが送られてきた場面を想定してください。<br /><br />このとき，<font color="red"><b>あなた</b></font>が感じると考えられる感情の位置を，アフェクト・グリッド上で示してください。</span></div><br/><div><img src="imgs/${jsPsych.timelineVariable('message')}.png" class = "emoji_stim"></div><br/>`;
        return html;
      },
      html: affect_grid1,
      data: {imgID: jsPsych.timelineVariable('message')},
    },
    {
      type: 'survey-likert',
      preamble: function(){
        var html = `<div class="inst_text"><span>（場面${Math.floor(Counter/3)+1}の続き）<br/>このメッセージに対し，<font color="red"><b>あなた</b></font>は次のそれぞれの感情をどの程度感じると思いますか。「0：まったく感じない」から「4：強く感じる」までの数字のうち，もっとも近いものを1つずつ選んでください。</span></div><br/><div><img src="imgs/${jsPsych.timelineVariable('message')}.png" class = "emoji_stim"></div><br/>`;
        return html;
      },
      questions: [
        { prompt: "満足な", labels: scale, required: true},
        { prompt: "悲しい", labels: scale, required: true},
        { prompt: "腹が立つ", labels: scale, required: true},
        { prompt: "嬉しい", labels: scale, required: true},
        { prompt: "気分が良い", labels: scale, required: true},
        { prompt: "不快な", labels: scale, required: true},
      ],
      data: {imgID: jsPsych.timelineVariable('message')},
    },
    {
      type: 'survey-likert',
      preamble: function(){
        var html = `<div class="inst_text"><span>（場面${Math.floor(Counter/3)+1}の続き）<br/>このメッセージの<font color="blue"><b>送り主</b></font>は，次のそれぞれの感情をどの程度感じていると思いますか。「0：まったく感じない」から「4：強く感じる」までの数字のうち，もっとも近いものを1つずつ選んでください。</span></div><br/><div><img src="imgs/${jsPsych.timelineVariable('message')}.png" class = "emoji_stim"></div><br/>`;
        return html;
      },
      questions: [
        { prompt: "満足な", labels: scale, required: true},
        { prompt: "悲しい", labels: scale, required: true},
        { prompt: "腹が立つ", labels: scale, required: true},
        { prompt: "嬉しい", labels: scale, required: true},
        { prompt: "気分が良い", labels: scale, required: true},
        { prompt: "不快な", labels: scale, required: true},
      ],
      data: {imgID: jsPsych.timelineVariable('message')},
    },
  ],
  button_label: '次へ',
  timeline_variables: jsPsych.randomization.sampleWithReplacement(joy_emoji, 1)[0],
  randomize_order: true,
  on_finish: function () { 
    Counter += 1 ;
  },
}

var Hyouka = {
  timeline: jsPsych.randomization.sampleWithoutReplacement([sad_hyoka, anger_hyoka, joy_hyoka], 1),
};

var oshimai = {
  type: 'instructions',
    pages: [
      `<div class="inst_text"><span>これですべて終了です。ご協力ありがとうございました。この画面を閉じて終了してください。</span></div>`,
    ],
    allow_backward: false,
    button_label_next:'終了',
    show_clickable_nav: false,
    on_load: function(data) {
        jsPsych.data.addProperties(par_info);
        jsPsych.data.displayData('csv');
        //saveData("filename.csv", jsPsych.data.dataAsCSV()) ;
      }
  };

timeline.push(nenrei, seibetsu, hajimeni, shitashisa, emoji1, emoji2, AGsetsumei, KadaiSetsumei, Hyouka, oshimai)

//timeline.push(joy_hyoka, oshimai)


jsPsych.init({
    timeline: timeline,
  });



function saveData(filename, filedata){
  $.ajax({
    type:'post',
    cache: false,
    url: 'record_data.php', // this is the path to the above PHP script
    data: {filename: filename, filedata: filedata}
  });
}
  </script>
</html>